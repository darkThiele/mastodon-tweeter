(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{37:function(t,e,a){t.exports=a(76)},60:function(t,e,a){},76:function(t,e,a){"use strict";a.r(e);var n=a(0),o=a.n(n),c=a(31),s=a.n(c),i=a(34),r=a(11),l=a(12),u=a.n(l),m=a(16),h=a(6),p=a(7),d=a(9),f=a(8),v=a(10),b=a(15),S=a.n(b),k=function(t){function e(){var t,a;Object(h.a)(this,e);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(a=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(o)))).state={instance:localStorage.getItem("instance_name")},a.onFormSubmit=function(t){t.preventDefault(),a.props.onInstanceSubmit(a.state.instance)},a}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this;return o.a.createElement("div",{className:"authorization ui form"},o.a.createElement("form",{className:"ui form",onSubmit:this.onFormSubmit},o.a.createElement("div",{className:"field"},o.a.createElement("label",null,"User Instance"),o.a.createElement("input",{type:"text",value:this.state.instance,onChange:function(e){return t.setState({instance:e.target.value})}}))))}}]),e}(o.a.Component),_=a(32),g=function(t){function e(){var t,a;Object(h.a)(this,e);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(a=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(o)))).state={text:""},a.onFormSubmit=function(t){a.props.onTootSubmit(a.state.text),a.setState({text:""})},a.keyDownSubmit=function(t){t.ctrlKey&&13===t.keyCode&&a.onFormSubmit()},a.buttonPressSubmit=function(t){t.preventDefault(),a.onFormSubmit()},a}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this;return console.log(this.state.text),o.a.createElement("div",{className:"toot ui form"},o.a.createElement("form",{className:"ui form",onSubmit:this.onFormSubmit},o.a.createElement("div",{className:"field"},o.a.createElement("label",null,"User Toot"),o.a.createElement("textarea",{value:this.state.text,onChange:function(e){return t.setState({text:e.target.value})},onKeyDown:this.keyDownSubmit})),o.a.createElement(_.MobileView,null,o.a.createElement("button",{class:"fluid ui button",onClick:this.buttonPressSubmit},"Submit"))))}}]),e}(o.a.Component),w=(a(60),function(t){function e(){var t,a;Object(h.a)(this,e);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(a=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(o)))).onTootClick=function(t){a.props.onTootClick(a.props.toot)},a}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return this.props.toot.account?o.a.createElement("div",{className:"toot-detail item",onClick:this.onTootClick},o.a.createElement("img",{alt:"icon",className:"ui avatar image",src:this.props.toot.account.avatar}),o.a.createElement("div",{className:"content"},o.a.createElement("div",{className:"header"},this.props.toot.account.display_name," @",this.props.toot.account.acct),o.a.createElement("div",{className:"description"},this.props.toot.content.replace(/<\/?[^>]+>/gi,"")))):o.a.createElement("div",{className:"toot-detail item"},"\u30c8\u30a5\u30fc\u30c8\u304c\u524a\u9664\u3055\u308c\u3066\u3044\u307e\u3059")}}]),e}(o.a.Component)),y=function(t){var e=t.toot_list.map(function(e){var a=JSON.parse(e.payload);return o.a.createElement(w,{key:a.id,toot:a,onTootClick:t.onTootClick})});return o.a.createElement("div",{className:"timeline ui relaxed selection divided list"},e)},E=function(t){function e(){var t,a;Object(h.a)(this,e);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(a=Object(d.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(o)))).state={instance:null,client:null,authorize_code:null,access_token:null,user_credentials:null,ws:null,toots:[]},a.onInstanceSubmit=function(){var t=Object(m.a)(u.a.mark(function t(e){var n,o,c,s;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return"mastodon-Tweeter",n="read write follow",o="https://darkthiele.github.io/mastodon-tweeter/",c="https://".concat(e),t.next=6,S.a.post("".concat(c,"/api/v1/apps"),{client_name:"mastodon-Tweeter",redirect_uris:o,scopes:n});case 6:s=t.sent,localStorage.clear(),localStorage.setItem("instance_name",e),localStorage.setItem("client_data",JSON.stringify(s.data)),a.setState({instance:e,client:s.data}),window.open("".concat(c,"/oauth/authorize?scope=").concat(n,"&response_type=code&redirect_uri=").concat(o,"&client_id=").concat(s.data.client_id),"_self");case 12:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a.onTootSubmit=function(){var t=Object(m.a)(u.a.mark(function t(e){var n,o;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="https://".concat(a.state.instance),o=a.state.access_token,t.next=4,S.a.post("".concat(n,"/api/v1/statuses"),{status:e},{headers:{Authorization:"Bearer ".concat(o)}});case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a.onTootClick=function(){var t=Object(m.a)(u.a.mark(function t(e){var n,o;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="https://".concat(a.state.instance),o=a.state.access_token,t.next=4,S.a.post("".concat(n,"/api/v1/statuses/").concat(e.id,"/favourite"),{},{headers:{Authorization:"Bearer ".concat(o)}});case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a}return Object(v.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){var t=this.props.qs.code;t&&localStorage.setItem("authorize_code",t);var e=localStorage.getItem("instance_name"),a=null;e&&(a=JSON.parse(localStorage.getItem("client_data")));var n=localStorage.getItem("authorize_code"),o=localStorage.getItem("access_token");this.setState({instance:e,client:a,authorize_code:n,access_token:o})}},{key:"componentDidUpdate",value:function(){var t=this,e="https://".concat(this.state.instance);if(this.state.instance&&this.state.client&&this.state.authorize_code&&!this.state.access_token){var a=S.a.post("".concat(e,"/oauth/token"),{client_id:this.state.client.client_id,client_secret:this.state.client.client_secret,grant_type:"authorization_code",code:this.state.authorize_code,redirect_uri:"https://darkthiele.github.io/mastodon-tweeter/"});a.then(function(t){return localStorage.setItem("access_token",t.data.access_token)}),a.then(function(e){return t.setState({access_token:e.data.access_token})})}if(this.state.instance&&this.state.client&&this.state.authorize_code&&this.state.access_token&&!this.state.ws){var n=new WebSocket("wss://".concat(this.state.instance,"/api/v1/streaming?access_token=").concat(this.state.access_token,"&stream=public:local"));n.onmessage=function(e){var a=JSON.parse(e.data);t.state.toots.unshift(a),t.setState({toots:t.state.toots.slice(0,50)})},this.setState({ws:n})}}},{key:"componentWillUnmount",value:function(){this.state.ws.close()}},{key:"render",value:function(){return this.state.client?o.a.createElement("div",{className:"ui container"},o.a.createElement("div",{className:"ui segment"},o.a.createElement(k,{onInstanceSubmit:this.onInstanceSubmit}),o.a.createElement(g,{onTootSubmit:this.onTootSubmit})),o.a.createElement("div",{className:"ui segment"},o.a.createElement(y,{toot_list:this.state.toots,onTootClick:this.onTootClick}))):o.a.createElement("div",{className:"ui container"},o.a.createElement(k,{onInstanceSubmit:this.onInstanceSubmit}))}}]),e}(o.a.Component),O=a(33),j=a.n(O);s.a.render(o.a.createElement(i.a,null,o.a.createElement(r.a,{render:function(t){return o.a.createElement(E,{qs:j.a.parse(t.location.search)})}})),document.querySelector("#root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.9d230576.chunk.js.map